<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ebook Image Slider Pro++</title>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:"Sarabun",sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  overflow:hidden;
}

.topbar{
  position:fixed;
  top:0;
  width:100%;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(10px);
  padding:10px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  z-index:10;
}

input, select{
  padding:6px 10px;
  border-radius:8px;
  border:none;
}

button{
  padding:6px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#00c6ff;
  color:#000;
  font-weight:600;
}

.slider{
  display:flex;
  height:100vh;
  width:100vw;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  scroll-behavior:smooth;
}

.slide{
  min-width:100vw;
  height:100vh;
  padding:90px 20px 120px 20px;
  scroll-snap-align:start;
  display:flex;
  justify-content:center;
  align-items:center;
}

.grid{
  display:grid;
  gap:15px;
  width:100%;
  max-width:1000px;
}

.grid img{
  width:100%;
  height:100%;
  object-fit:contain;
  border-radius:15px;
  background:#111;
  box-shadow:0 10px 25px rgba(0,0,0,0.5);
}

.bottom-control{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.6);
  padding:15px;
  border-radius:15px;
  backdrop-filter:blur(10px);
  display:flex;
  flex-direction:column;
  gap:10px;
  width:90%;
  max-width:600px;
}

.audio-box{
  display:flex;
  gap:10px;
}

audio{
  width:100%;
}

.page-indicator{
  position:fixed;
  bottom:20px;
  right:20px;
  background:rgba(0,0,0,0.6);
  padding:8px 15px;
  border-radius:10px;
}
</style>
</head>

<body>

<div class="topbar">
  <input type="file" id="imageInput" accept="image/*" multiple>
  <select id="layoutSelect">
    <option value="1">1 รูป / หน้า</option>
    <option value="2">2 รูป / หน้า</option>
    <option value="3">3 รูป / หน้า</option>
    <option value="4">4 รูป / หน้า</option>
    <option value="6">6 รูป / หน้า</option>
    <option value="9">9 รูป / หน้า</option>
  </select>
  <button onclick="prev()">◀</button>
  <button onclick="next()">▶</button>
</div>

<div class="slider" id="slider">
  <div class="slide">
    <h2>อัปโหลดรูปได้สูงสุด 300 รูป</h2>
  </div>
</div>

<div class="bottom-control">
  <div class="audio-box">
    <input type="text" id="audioURL" placeholder="วางลิงก์ Google Drive Audio">
    <button onclick="loadAudio()">ใส่เสียง</button>
  </div>
  <audio id="audioPlayer" controls></audio>
</div>

<div class="page-indicator">
  หน้า <span id="pageNum">1</span>
</div>

<script>

const slider = document.getElementById("slider")
const layoutSelect = document.getElementById("layoutSelect")
let images = []
let totalSlides = 1

document.getElementById("imageInput").addEventListener("change", function(){
  if(this.files.length > 300){
    alert("อัปโหลดได้ไม่เกิน 300 รูป")
    return
  }
  images = Array.from(this.files)
  buildSlides()
})

layoutSelect.addEventListener("change", buildSlides)

function buildSlides(){
  const perPage = parseInt(layoutSelect.value)
  let slidesHTML = ""

  for(let i=0; i<images.length; i+=perPage){
    const chunk = images.slice(i, i+perPage)

    let cols = Math.ceil(Math.sqrt(perPage))
    slidesHTML += `<div class="slide"><div class="grid" style="grid-template-columns:repeat(${cols},1fr)">`

    chunk.forEach(img=>{
      const url = URL.createObjectURL(img)
      slidesHTML += `<img src="${url}">`
    })

    slidesHTML += `</div></div>`
  }

  slider.innerHTML = slidesHTML || `<div class="slide"><h2>ไม่มีรูป</h2></div>`
  totalSlides = Math.ceil(images.length / perPage)
  goSlide(0)
}

function next(){
  slider.scrollBy({left:window.innerWidth,behavior:"smooth"})
}

function prev(){
  slider.scrollBy({left:-window.innerWidth,behavior:"smooth"})
}

function goSlide(index){
  slider.scrollTo({left:index*window.innerWidth,behavior:"smooth"})
  document.getElementById("pageNum").innerText = index+1
}

slider.addEventListener("scroll",()=>{
  let index = Math.round(slider.scrollLeft / window.innerWidth)
  document.getElementById("pageNum").innerText = index+1
})

function loadAudio(){
  let url = document.getElementById("audioURL").value.trim()
  if(!url) return alert("ใส่ลิงก์ก่อน")

  if(url.includes("drive.google.com")){
    let idMatch = url.match(/[-\w]{25,}/)
    if(idMatch){
      url = "https://drive.google.com/uc?export=download&id=" + idMatch[0]
    }
  }

  document.getElementById("audioPlayer").src = url
}

</script>

</body>
</html>